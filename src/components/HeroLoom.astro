---
const { id, title = 'Intro video' } = Astro.props as { id: string; title?: string };
---

{id && (
  <section class="mb-6">
    <div class="loom-container" data-loom-id={id}>
      <!-- Thumbnail placeholder - click to load -->
      <div class="loom-placeholder">
        <img
          src={`https://cdn.loom.com/sessions/thumbnails/${id}-00001.jpg`}
          alt={title}
          class="loom-thumbnail"
          loading="lazy"
        />
        <button class="loom-play-button" aria-label="Play video">
          <svg width="80" height="80" viewBox="0 0 80 80">
            <circle cx="40" cy="40" r="38" fill="rgba(255, 255, 255, 0.95)" stroke="rgba(0, 0, 0, 0.1)" stroke-width="2"/>
            <polygon points="32,26 32,54 56,40" fill="#000"/>
          </svg>
        </button>
      </div>
      <!-- Actual iframe - loaded on click -->
      <div class="loom-iframe-wrapper" style="display: none;">
        <iframe
          data-src={`https://www.loom.com/embed/${id}?autoplay=1`}
          title={title}
          frameborder="0"
          allowfullscreen
          allow="autoplay"
          referrerpolicy="no-referrer"
          style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;"
        ></iframe>
      </div>
    </div>
  </section>
)}

<style>
  .loom-container {
    position: relative;
    padding-bottom: 56.25%;
    height: 0;
    overflow: hidden;
    background: #000;
    border-radius: 8px;
  }

  .loom-placeholder {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    cursor: pointer;
    transition: opacity 0.3s ease;
  }

  .loom-placeholder:hover {
    opacity: 0.9;
  }

  .loom-thumbnail {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .loom-play-button {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: none;
    border: none;
    cursor: pointer;
    transition: transform 0.2s ease, opacity 0.3s ease;
    opacity: 0.9;
    padding: 0;
  }

  .loom-play-button:hover {
    transform: translate(-50%, -50%) scale(1.1);
    opacity: 1;
  }

  .loom-play-button svg {
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
  }

  .loom-iframe-wrapper {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }
</style>

<script>
  // Click-to-load functionality
  document.addEventListener('DOMContentLoaded', () => {
    const containers = document.querySelectorAll('.loom-container');

    containers.forEach(container => {
      const placeholder = container.querySelector('.loom-placeholder');
      const iframeWrapper = container.querySelector('.loom-iframe-wrapper') as HTMLElement;
      const iframe = iframeWrapper?.querySelector('iframe');

      if (placeholder && iframe && iframeWrapper) {
        placeholder.addEventListener('click', () => {
          // Load the iframe
          const src = iframe.getAttribute('data-src');
          if (src) {
            iframe.setAttribute('src', src);
          }

          // Hide placeholder, show iframe
          (placeholder as HTMLElement).style.display = 'none';
          iframeWrapper.style.display = 'block';
        });
      }
    });
  });
</script>


